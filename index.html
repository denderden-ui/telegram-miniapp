<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–æ—á–Ω—ã–π –º–∏–Ω–∏-–∞–ø–ø</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏–Ω–∏-–∏–≥—Ä—É!</h1>

        <p id="user-id">–ó–∞–≥—Ä—É–∑–∫–∞ ID...</p>

        <div class="balance">
            <p><strong>üßø –¢–æ–∫–µ–Ω—ã:</strong> <span id="tokens">?</span></p>
            <p><strong>üí∏ –í–∞–ª—é—Ç–∞:</strong> <span id="currency">?</span></p>
        </div>

        <button id="open-card-btn" onclick="openCard()">üé¥ –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ä—Ç—É</button>

        <div class="card-display" id="card-display">
            <img id="card-image" src="" alt="Card Image" class="card-img" />
            <div id="card-info" class="card-info">
                <p><strong>üìõ –ù–∞–∑–≤–∞–Ω–∏–µ:</strong> <span id="card-name"></span></p>
                <p><strong>üìù –û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="card-description"></span></p>
                <p><strong>‚≠êÔ∏è –†–µ–¥–∫–æ—Å—Ç—å:</strong> <span id="card-rarity"></span></p>
                <p><strong>üí∞ –ù–∞–≥—Ä–∞–¥–∞:</strong> <span id="card-reward"></span></p>
            </div>
        </div>

        <footer>
            <p>Powered by Telegram WebApp</p>
        </footer>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const userId = params.get('user_id');
        document.getElementById('user-id').textContent = userId ? `–í–∞—à ID: ${userId}` : 'ID –Ω–µ –Ω–∞–π–¥–µ–Ω';

        async function fetchBalance() {
            if (!userId) return;
            try {
                const res = await fetch(`/api/user-balance?user_id=${userId}`);
                const data = await res.json();
                document.getElementById('tokens').textContent = data.tokens;
                document.getElementById('currency').textContent = data.currency;
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞:', err);
            }
        }

        async function openCard() {
            if (!userId) return;
            try {
                const res = await fetch(`/api/open-card?user_id=${userId}`);
                const data = await res.json();

                if (data.error) {
                    alert(data.error);
                    return;
                }

                document.getElementById('card-image').src = data.image;
                document.getElementById('card-name').textContent = data.name;
                document.getElementById('card-description').textContent = data.description;
                document.getElementById('card-rarity').textContent = data.rarity;
                document.getElementById('card-reward').textContent = data.reward;

                document.getElementById('tokens').textContent = data.tokens;
                document.getElementById('currency').textContent = data.currency;
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–∞—Ä—Ç—ã:', err);
            }
        }

        window.onload = fetchBalance;
    </script>
</body>
</html>
